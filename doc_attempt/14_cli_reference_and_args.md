# CLI arguments and application integration

This page describes how Samurai applications declare and parse command-line arguments, and the common options available to users.

## Minimal pattern

```cpp
auto& app = samurai::initialize("Description", argc, argv);
// Add your application options on app (CLI11)
SAMURAI_PARSE(argc, argv);
// ... run your simulation ...
samurai::finalize();
```

- `samurai::initialize` sets the description, reads Samurai built-in options, starts timers, and initializes MPI/PETSc if enabled.
- `SAMURAI_PARSE(argc, argv)` parses CLI11 options and accepts unknown options (pass-through for libraries or app-specific flags).
- `samurai::finalize()` prints timers if requested and finalizes MPI/PETSc when enabled.

## Help

- Use `-h` or `--help` to print the help message generated by CLI11 (including defaults when available).

## Samurai built-in options

These options are provided automatically by `samurai::initialize` (from `samurai/arguments.hpp`). Group names in parentheses reflect how they appear in help.

- `--timers` (Tools): Print timers at program end.
- `--finer-level-flux <int>` (SAMURAI): Computation of fluxes at finer levels (default: 0, i.e. no finer level flux, -1 for max_level flux, > 0 for current level + finer_level_flux).
- `--refine-boundary` (SAMURAI): Keep the boundary refined at `max_level`.
- `--save-debug-fields` (SAMURAI): Add debug fields during save (coordinates, indices, levels, ...).
- `--mr-eps <double>` (Multiresolution): The epsilon used by the multiresolution to adapt the mesh.
- `--mr-reg <double>` (Multiresolution): The regularity criteria used by the multiresolution to adapt the mesh.
- `--mr-rel-detail` (Multiresolution): Use relative detail instead of absolute detail.
- `--dont-redirect-output` (IO, only when built with MPI): Do not redirect stdout on ranks â‰  0. By default, non-root ranks are silenced.

Notes

- Unknown options are accepted by default (pass-through) to ease integration with external libraries and application-specific flags.

## PETSc options (when enabled)

If compiled with PETSc (`SAMURAI_WITH_PETSC`), PETSc is initialized automatically. PETSc command-line options can be provided alongside Samurai options and are forwarded to PETSc. The initialization disables the PETSc `-options_left` warning to avoid noise when mixing CLI11 and PETSc options.

## Typical application options used in demos

Applications add their own options on the returned `app` object. Common patterns (names exactly as used in demos):

- Simulation domain
  - `--left <double>`, `--right <double>` (1D bounds)
  - `--min-corner <vec>`, `--max-corner <vec>` (box bounds; provide space-separated values as used in demos)
- Resolution and adaptation
  - `--start-level <size_t>`, `--min-level <size_t>`, `--max-level <size_t>`
  - `--max-refinement-level <size_t>` (graduation tutorial)
  - `--with-correction` (apply flux correction at interfaces in level set example)
  - `--with-corner`, `--with-graduation` (mesh generator tutorials)
- Time integration and CFL
  - `--dt <double>`, `--cfl <double>`, `--Ti <double>`, `--Tf <double>`
- Physics/model switches
  - `--velocity <double>` (advection)
  - `--diff-coeff <double>` (heat)
  - `--explicit` (use explicit scheme in heat examples)
  - `--explicit-reaction`, `--explicit-diffusion` (Nagumo)
  - `--init-sol <string>` (heat; e.g., "dirac"/"crenel" as used in demos)
  - `--case <string>` (reconstruction tutorials)
  - `--nb-bubbles <size_t>` (pablo example)
  - `--input <path>` (from_obj demo; required and must exist)
- Output control
  - `--path <dir>`, `--filename <prefix>`, `--nfiles <size_t>`
  - `--save-final-state-only`
  - `--export-velocity`, `--export-reconstruct` (selected demos)

Refer to the demos in `demos/` for the full set of options per example; each app declares only the options it supports.

## Invocation examples

- Run with timers and a typical set of simulation controls:

  ```bash
  ./your_executable --timers --min-level 4 --max-level 8 --cfl 0.45 \
    --path output --filename run --nfiles 10
  ```

- 1D advection (domain, velocity):

  ```bash
  ./advection_1d --left -1.0 --right 1.0 --velocity 1.0 --cfl 0.9 --max-level 8
  ```

## Alternative minimal initialization

Some tutorial programs call `samurai::initialize()` without arguments when no custom CLI is needed; use this form only if you do not expose application options.
